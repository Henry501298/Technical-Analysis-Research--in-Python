---
title: "ECO 4051 Financial Econometrics"
subtitle: "Assignment 2: Analyzing linear Regression"
author: "Henry Bowers"
output: word_document
---

```{r setup, include=FALSE}
# set the working directory first
library(quantmod)
library(PerformanceAnalytics)
library(corrplot)
library(lubridate)
library(gridExtra)
library(tidyr)
library(ggplot2)

# below we set some parameters for the markdown document, like printing the code, the size of the graphs etc
# changing these values have effect on the word output

```

## Q1: Data preparation 

```{r q1}
getSymbols(c("PFE","LRCX","STT","DLR","BLK", "BKR", "SPY"), from="2000-01-01", periodicity = "monthly")
mydata <- na.omit(merge(Ad(PFE), Ad(LRCX), Ad(STT), Ad(DLR), Ad(BLK), Ad(BKR), Ad(SPY)))


stock_rets <- na.omit(Return.calculate(xts(mydata), "log"))

head(stock_rets)
tail(stock_rets)


```

*Discussion:* Gathering stock adjusted data and benchmark adjusted data to calculate log returns and conduct return analysis. 


## Q2: Return correlation

```{r q2}

asset_rets = cor(stock_rets)
corrplot(asset_rets, method = 'number') # colorful number

```

*Discussion:* constructed a correlation matrix of log returns to see how closely related companies are to one another and to the benchmark (SPY). Looking at this data we could notice that the stock which has the largest correlation to the benchmark is BLK with a 0.74 correlation. This could mean when the market is down, BLK could experience the same amount of loss or more. Regarding the stock that has the lowest correlation it is DLR sitting at 0.42. DLR having 0.42 correlation mostly means the company doesn't get affected by market downturns as much to others, however this would most likely mean that DLR has a higher unsystematic risk, which is a company that is infected more by internal condidtions instead of condidtions of a benchmark. 


## Q3: Plotting

```{r q3}

stock_prices <- na.omit(merge(Ad(PFE), Ad(LRCX), Ad(STT), Ad(DLR), Ad(BLK), Ad(BKR), Ad(SPY)))

stock.df <- na.omit(data.frame(Date=time(stock_prices), Year = year(time(stock_prices)), coredata(merge(stock_prices, stock_rets))))

names(stock.df) <- c("Date","Year", "PFE", "LRCX", "STT", "DLR", "BLK", "BKR", "SPY", "PFE_ret", "LRCX_ret", "STT_ret", "DLR_ret", "BLK_ret", "BKR_ret", "SPY_ret")

plot1 <- ggplot(stock.df, aes(PFE_ret, SPY_ret)) + geom_point() + geom_vline(xintercept = 0) + geom_hline(yintercept = 0) + geom_smooth(method="lm", se=FALSE) + theme_bw() + labs(x= "SPY", y="PFE")

plot2 <- ggplot(stock.df, aes(LRCX_ret, SPY_ret)) + geom_point() + geom_vline(xintercept = 0) + geom_hline(yintercept = 0) + geom_smooth(method="lm", se=FALSE) + theme_bw() + labs(x= "SPY", y="LRCX")

plot3 <-  ggplot(stock.df, aes(STT_ret, SPY_ret)) + geom_point() + geom_vline(xintercept = 0) + geom_hline(yintercept = 0) + geom_smooth(method="lm", se=FALSE) + theme_bw() + labs(x= "SPY", y="STT")

plot4 <-  ggplot(stock.df, aes(DLR_ret, SPY_ret)) + geom_point() + geom_vline(xintercept = 0) + geom_hline(yintercept = 0) + geom_smooth(method="lm", se=FALSE) + theme_bw() + labs(x="SPY", y="DLR")

plot5 <-  ggplot(stock.df, aes(BLK_ret, SPY_ret)) + geom_point() + geom_vline(xintercept = 0) + geom_hline(yintercept = 0) + geom_smooth(method="lm", se=FALSE) + theme_bw() + labs(x="SPY", y="BLK")

plot6 <-  ggplot(stock.df, aes(BKR_ret, SPY_ret)) + geom_point() + geom_vline(xintercept = 0) + geom_hline(yintercept = 0) + geom_smooth(method="lm", se=FALSE) + theme_bw() + labs(x="SPY", y="BKR")

grid.arrange(plot1, plot2, plot3, plot4, plot5, plot6, ncol=3)

```

*Discussion:* Vizualzing the regression, this goes back to my prevous response regarding the correlation matrix. When looking at the linear regression the model, the returns that have a tighter spread to the line of best fit are the stocks that have a higher correlation to the market which is the X variable that remains constant. Stocks that have returns with a more lose spread, then to have a far less correlation to the market. Out the five stocks, two of the linear regression models have a tight spread and those are BLK and STT. going back to the correlation matrix, you could notice that does two stocks are the ones with the highest correlation.  


## Q4: Estimate the linear regression model 

```{r q4}

stock_returns <- (stock_rets)[,-7]

Benchmark_returns <- na.omit(Ad(Return.calculate(xts(SPY), "log")))

Regression_Analysis <- round(table.CAPM(stock_returns, Benchmark_returns), digits = 2)

R_squared <- (Regression_Analysis)[5,]

round(CAPM.beta(stock_returns, Benchmark_returns), digits = 2)

Beta_Values <- c(0.74, 1.38, 1.45, 0.7, 1.42, 1.5)

regression_model <- rbind(R_squared, Beta_Values)
regression_model


```

*Discussion:* Here I created a table of the R - Square and Beta of the stocks, which is row two (was unable to name row 2). One thing to notice so far is that there is a pattern, the patterns that we have notice is that with the correlation matrix. Stocks that have a higher correlation graphical have a tighter spread regression model, now what could that mean in terms of beta? if we look at the stocks that have the highest correlation to the market which is STT and BLK, you can notice that STT has a beta of 1.45 and BLK has a beta of 1.42. Stocks that have a higher beta than 1 compared to the market tend to be seen as much more risky, and with risk we expect higher rate of return to compensate for risk. 


## Q5: Beta Visualization 

```{r q5}

stock_returns <- (stock_rets)[,-7]

Benchmark_returns <- na.omit(Ad(Return.calculate(xts(SPY), "log")))

Betas <- CAPM.beta(stock_returns, Benchmark_returns)

barplot(Betas, xlab = "Stocks", ylab = "Beta", main = "Beta Visualization", col = "darkblue")

```

*Discussion:* An interesting factor we should note is that BKR is actually the highest beta of 1.50. Now, regarding the correlation matrix they have a correlation of 0.54 and when looking at their linear regression model, it tends to be more losely spread then it is closedly spread. 



